/*! Copyright (C) 2014 AJAXBOARD. All rights reserved. */!function(e,t){"use strict";function r(e){return u.ajax("html",u.current_url,null,null,e)}function n(e){if(!t("#cmtPosition").length)return!1;if(l)return t(".fdb_lst_ul").append(t("#cmt_alert").show()),!1;var n=r(e);return n.done(function(e){var r=t("<div>").append(t.parseHTML(e)).find("#cmtPosition");t(".cmt_editor").append(t("#re_cmt").hide()),t("body").append(t("#cmt_alert").hide()),t("#cmtPosition").html(r.html()),board("#bd_"+u.module_srl+"_"+(u.document_srl||0))}),n}function i(e){l=!1;var t=n({cpage:e});return t&&t.done(function(){u.current_url=u.current_url.setQuery("cpage",e),u.scrolling(1,SLIDE_DURATION,"#cmtPosition")}),t}function o(e){if(!t(".bd_lst_wrp").length)return!1;var n=r(e);return n.done(function(e){var r=t("<div>").append(t.parseHTML(e)).find(".bd_lst_wrp"),n=t(".bd_lst_wrp");n.children(".bd_lst").html(r.children(".bd_lst").html()),n.children(".bd_pg").html(r.children(".bd_pg").html()),t(".cmt_pg").remove(),board("#bd_"+u.module_srl+"_"+(u.document_srl||0))}),n}function c(e){var t=o({page:e});return t&&t.done(function(){u.current_url=u.current_url.setQuery("page",e)}),t}var u=e.ajaxboard,l=!1,m=!1;u.insertTrigger("clearEditor","after",function(){t(".simple_wrt textarea[id*='editor_']").val("")}),u.insertTrigger("events.connect","after",function(){if(!m){m=!0;var r=e.reComment;r&&t.isFunction(r)&&(e.reComment=function(e,t,n){l=!0,r(e,t,n)});var o=e.doCallModuleAction;if(o&&t.isFunction(o)){var s=function(e){"success"!==e.message&&alert(e.message)};e.doCallModuleAction=function(e,r,n){var i=["procDocumentVoteUp","procDocumentVoteDown","procDocumentDeclare","procCommentVoteUp","procCommentVoteDown","procCommentDeclare"];if(t.inArray(r,i)){var c={target_srl:n,cur_mid:u.current_mid,mid:u.current_mid};return exec_xml(e,r,c,s)}return t.isFunction(o)?o(e,r,n):void 0}}var d=e.completeInsertComment;d&&t.isFunction(d)&&(e.completeInsertComment=function(){u.clearEditor()}),t("#cmtPosition").on("click",".fdb_nav [href]",function(){var e=t(this).attr("href");e.indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#")));var r=e.getQuery("act"),i=e.getQuery("comment_srl");return i&&"dispBoardDeleteComment"==r?(u.deleteComment(i,e,function(e){alert(e.message)},function(){n()}),!1):void 0}).on("click",".bd_pg [href], .cmt_pg [href]",function(){var e=t(this),r=e.attr("href");r.indexOf("#")>-1&&(r=r.substring(0,r.indexOf("#")));var n=r.getQuery("cpage");return n?(i(n>1&&e.hasClass("direction")?"":n),!1):void 0}),t("#re_cmt .close").on("click",function(){l=!1,t("#re_cmt").hide(),n()}),t("#re_cmt input[type='submit']").on("click",function(){l=!1,t("#re_cmt").hide()}),t(".bd_lst_wrp").on("click",".bd_pg [href]",function(){var e=t(this).attr("href");e.indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#")));var r=e.getQuery("page");return c(r||1),!1})}}),u.insertTrigger("events.insertDocument","before",function(){o()}),u.insertTrigger("events.voteDocument","before",function(e){var r=e.extra_vars.point;u.document_srl==e.target_srl&&r>0?t(".rd_vote").children().eq(0).children().eq(0).html("♥ "+r):t(".rd_vote").children().eq(1).children().eq(0).html("♥ "+r)}),u.insertTrigger("events.insertComment","before",function(e){(t("#comment_"+e.parent_srl).length||t("#"+e.parent_srl+"_comment").length)&&n()}),u.insertTrigger("events.deleteComment","before",function(e){t("#comment_"+e.target_srl).length&&n()}),u.insertTrigger("events.voteComment","before",function(e){!l&&t("#comment_"+e.target_srl).length&&n()})}(this,jQuery);
