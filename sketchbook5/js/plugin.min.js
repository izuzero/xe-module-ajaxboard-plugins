/*! Copyright (C) 2014 AJAXBOARD. All rights reserved. */!function(e,t){"use strict";function r(e){return u.ajax("html",u.current_url,null,null,e)}function n(e){if(!t("#cmtPosition").length)return!1;if(l)return t(".fdb_lst_ul").append(t("#cmt_alert").show()),!1;var n=r(e).done(function(e){var r=t("<div>").append(t.parseHTML(e)).find("#cmtPosition");t(".cmt_editor").append(t("#re_cmt").hide()),t("body").append(t("#cmt_alert").hide()),t("#cmtPosition").html(r.html()),board("#bd_"+u.module_srl+"_"+(u.document_srl||0))});return n}function o(e){l=!1;var t=n({cpage:e});return t&&t.done(function(){u.current_url=u.current_url.setQuery("cpage",e),u.scrolling(1,SLIDE_DURATION,"#cmtPosition")}),t}function i(e){if(!LIST_STYLE||!t(".bd_lst_wrp").length)return!1;var n;switch(LIST_STYLE){case"webzine":n="ol.bd_zine";break;case"gallery":n="ol.bd_tmb_lst";break;case"cloud_gall":n="ul.bd_cloud";break;case"faq":n="ul.bd_faq";break;default:n="table.bd_tb_lst"}var o=r(e).done(function(e){var r=t("<div>").append(t.parseHTML(e));t(n).html(r.find(n).html()),t(".bd_pg").html(r.find(".bd_pg").html()),t(".cmt_pg").remove(),board("#bd_"+u.module_srl+"_"+(u.document_srl||0))});return o}function c(e){var t=i({page:e});return t&&t.done(function(){u.current_url=u.current_url.setQuery("page",e)}),t}var u=e.ajaxboard,l=!1,a=!1;u.insertTrigger("clearEditor","after",function(){t(".simple_wrt textarea[id*='editor_']").val("")}),u.insertTrigger("events.connect","after",function(){if(!a){a=!0;var r=e.reComment;r&&t.isFunction(r)&&(e.reComment=function(e,t,n){l=!0,r(e,t,n)});var i=e.doCallModuleAction;if(i&&t.isFunction(i)){var s=function(e){"success"!==e.message&&alert(e.message)};e.doCallModuleAction=function(e,r,n){var o=["procDocumentVoteUp","procDocumentVoteDown","procDocumentDeclare","procCommentVoteUp","procCommentVoteDown","procCommentDeclare"];if(t.inArray(r,o)>-1){var c={target_srl:n,cur_mid:u.current_mid,mid:u.current_mid};return exec_xml(e,r,c,s)}return t.isFunction(i)?i(e,r,n):void 0}}var m=e.completeInsertComment;m&&t.isFunction(m)&&(e.completeInsertComment=function(){u.clearEditor()}),t("#cmtPosition").on("click",".fdb_nav [href]",function(){var e=t(this).attr("href");e.indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#")));var r=e.getQuery("act"),o=e.getQuery("comment_srl");return o&&"dispBoardDeleteComment"==r?(u.deleteComment(o,e,function(e){alert(e.message)},function(){n()}),!1):void 0}).on("click",".bd_pg [href], .cmt_pg [href]",function(){var e=t(this),r=e.attr("href");r.indexOf("#")>-1&&(r=r.substring(0,r.indexOf("#")));var n=r.getQuery("cpage");return n?(o(n>1&&e.hasClass("direction")?"":n),!1):void 0}),t("#re_cmt .close").on("click",function(){l=!1,t("#re_cmt").hide(),n()}),t("#re_cmt input[type='submit']").on("click",function(){l=!1,t("#re_cmt").hide()}),t(".bd_lst_wrp").on("click",".bd_pg [href]",function(){var e=t(this).attr("href");e.indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#")));var r=e.getQuery("page");return c(r||1),!1})}}),u.insertTrigger("events.insertDocument","before",function(){i()}),u.insertTrigger("events.voteDocument","before",function(e){var r=e.extra_vars.point;u.document_srl==e.target_srl&&r>0?t(".rd_vote").children().eq(0).children().eq(0).html("♥ "+r):t(".rd_vote").children().eq(1).children().eq(0).html("♥ "+r)}),u.insertTrigger("events.insertComment","before",function(e){(t("#comment_"+e.parent_srl).length||t("#"+e.parent_srl+"_comment").length)&&n()}),u.insertTrigger("events.deleteComment","before",function(e){t("#comment_"+e.target_srl).length&&n()}),u.insertTrigger("events.voteComment","before",function(e){!l&&t("#comment_"+e.target_srl).length&&n()})}(this,jQuery);
