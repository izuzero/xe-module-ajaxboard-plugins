/*! Copyright (C) 2014 AJAXBOARD. All rights reserved. */!function(t,n){"use strict";function e(){var t=window,n="inner";return"innerWidth"in t||(n="client",t=document.documentElement||document.body),{width:t[n+"Width"],height:t[n+"Height"]}}function i(t){return u.ajax("html",u.current_url,null,null,t)}function o(){var t=n(".flatBoard .webzine-style .author");t.find("img").length&&t.removeClass("author").css("margin-right","10px");var i=n(".flatBoard"),o=i.find(".m-gallery>.list>li");o.find("img[title='file']").hide();var r=i.find(".m-webzine>.list>li");r.find("img[title='file']").hide();var c=i.find(".m-talkbox>.list>li");c.find("img[title='file']").hide(),c.find(".bubble").width(c.width()-75),e().width>567&&r.find(".webzine-container").width(r.width()-145),n("input, select, textarea").cancelZoom()}function r(t){if(!a||!n(".flatBoard").length)return!1;n.isPlainObject(t)||(t={});var e=i(t).done(function(t){var e=n("<div>").append(n.parseHTML(t)).find(".flatBoard"),i=n(".flatBoard");i.find(a+">.list").html(e.find(a+">.list").html()),i.find("footer>.paging").html(e.find("footer>.paging").html()),n.each(function(t,n){u.current_url=u.current_url.setQuery(t,n)}),o()});return e}function c(t){return r({page:t})}function l(t,e){if(!n("#comment").length)return!1;if(!e&&(!d||n(".flatBoard .comment-control .btClose").filter(":visible").length))return n(".flatBoard .comment-list").append(n("#cmt_alert").show()),f++,!1;n.isPlainObject(t)||(t={});var r=i(t).done(function(e){var i=n("<div>").append(n.parseHTML(e)).find("#comment"),r=n("#comment");n("body").append(n("#cmt_alert").hide()),r.find(".read-control .comment-num .num").html(i.find(".read-control .comment-num .num").html()),r.find(".comment").html(i.find(".comment").html()),n.each(t,function(t,n){u.current_url=u.current_url.setQuery(t,n)}),o(),d=!0,f=0});return r}function m(t){return l({cpage:t},!0)}var a,d=!0,f=0,u=t.ajaxboard;t.clickCmtAlert=function(){l(null,!0)},u.insertTrigger("clearEditor","after",function(){n("#rText").val("")});var s=!1;u.insertTrigger("events.connect","after",function(){if(!s){s=!0;var i=n(".flatBoard"),o=t.doCallModuleAction;if(o&&n.isFunction(o)){var r=function(t){"success"!==t.message&&alert(t.message)};t.doCallModuleAction=function(t,e,i){var c=["procDocumentVoteUp","procDocumentVoteDown","procDocumentDeclare","procCommentVoteUp","procCommentVoteDown","procCommentDeclare"];if(n.inArray(e,c)>-1){var l={target_srl:i,cur_mid:u.current_mid,mid:u.current_mid};return exec_xml(t,e,l,r)}return n.isFunction(o)?o(t,e,i):void 0}}var a=t.completeInsertComment;a&&n.isFunction(a)&&(t.completeInsertComment=function(){u.clearEditor(),i.find(".comment-write .cWrite-body .btCancel").trigger("click")}),i.on("click",".comment-el .blind-text",function(){n(this).next(".blind-comment").toggle()}).on("click",".comment-control .btClose",function(){f&&(f=0,l())}).on("click","#comment .paging [href]",function(){var t=n(this),e=t.attr("href");e.indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#")));var i=e.getQuery("cpage");return m(i>1&&t.hasClass("direction")?"":i),!1}).on("click",".list-footer .paging [href]",function(){var t=n(this),e=t.attr("href");e.indexOf("#")>-1&&(e=e.substring(0,e.indexOf("#")));var i=e.getQuery("page");return c(i>1&&t.hasClass("direction")?"":i),!1}),e().width<768?i.on("click",".comment-el",function(){d=!1,n("#comment-control-dummy").show(),n(this).next(".comment-control").show(),n("body").on("touchmove",function(t){t.preventDefault()})}).on("click",".comment-body a, .secret-comment, .blind-text",function(t){t.stopPropagation()}).on("click",".comment-control .bt-cc-cancel",function(){n(this).closest(".comment-control").hide(),n("#comment-control-dummy").hide(),n("body").off("touchmove"),f&&l(null,!0)}):i.on("click",".comment-control .btMore",function(){var t=n(this);t.parent().prevAll(".phone").css("display","inline-block"),t.next(".btClose").css("display","inline-block"),t.hide()}).on("click",".comment-control .btClose",function(){var t=n(this);t.parent().prevAll(".phone").hide(),t.prev(".btMore").css("display","inline-block"),t.hide();var e=i.find(".m-blogbox>.list>li>.bubble"),o=i.find(".m-talkbox>.list>li>.bubble");e.find(".left-side").width(e.width()-340),o.find(".left-side").width(o.width()-345)}),n(window).resize(function(){var t=i.find(".m-webzine>.list>li");e().width<568?(t.find(".thumb-image").width("28%").css("margin-left","4%"),t.find(".webzine-container").width("68%")):(t.find(".thumb-image").width(130).css("margin-left","12px"),t.find(".webzine-container").width(t.width()-145));var n=i.find(".m-talkbox>.list>li");n.find(".bubble").width(n.width()-75)})}}),u.insertTrigger("events.insertDocument","before",function(){r()}),u.insertTrigger("events.deleteDocument","before",function(){r()}),u.insertTrigger("events.voteDocument","before",function(t){var e=t.extra_vars.point;n(".flatBoard").length&&t.target_srl==u.document_srl&&n(".flatBoard .read-control "+(e>0?".btVote":".btBlame")+">.num2>span").html(e)}),u.insertTrigger("events.insertComment","before",function(){l()}),u.insertTrigger("events.deleteComment","before",function(){l()}),u.insertTrigger("events.voteComment","before",function(t){n("#comment_"+t.target_srl).length&&l()}),n(function(){var t=[".m-list",".m-news",".m-webzine",".m-gallery",".m-blogbox",".m-talkbox"];n.each(t,function(t,e){return n(".flatBoard "+e).length?(a=e,!1):void 0})})}(this,jQuery);
